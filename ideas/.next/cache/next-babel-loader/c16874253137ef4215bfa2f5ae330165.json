{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\nimport React, { useEffect, Fragment } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport ReactPaginate from 'react-paginate';\nimport { selectArticlesState, selectPartialArticlesState, selectFilteredArticlesState, selectIsLoadingState, selectOffsetState, selectPageCountState, selectPerpageState, selectShowPlannerState, selectLoginState } from './states/states';\nimport { getArticles, setPartialArticles, setOffset, setPageCount, setLogout, setBookmarks, setUserId, setUsername, setAccessToken, setProvider, setFinishedArticles, setEmail } from './actions/articlesAction';\nimport { CSSTransition, TransitionGroup } from 'react-transition-group';\nimport { Spinner } from 'react-bootstrap';\nimport Article from './Article';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport Footer from '../components/Footer';\nimport axios from 'axios';\nimport { useRouter } from 'next/router';\nimport ArticleSearchBar from './ArticleSearchBar';\nimport { useMediaPredicate } from \"react-media-hook\";\n\nvar ArticleList = function ArticleList() {\n  var disPatch = useDispatch();\n  var router = useRouter();\n  var isLoading = useSelector(selectIsLoadingState);\n  var articles = useSelector(selectArticlesState);\n  var filteredArticles = useSelector(selectFilteredArticlesState);\n  var partialArticles = useSelector(selectPartialArticlesState);\n  var perpage = useSelector(selectPerpageState);\n  var pageCount = useSelector(selectPageCountState);\n  var offset = useSelector(selectOffsetState);\n  var showPlanner = useSelector(selectShowPlannerState);\n  var smallerThan800 = useMediaPredicate(\"(max-width: 800px)\");\n  var isLogin = useSelector(selectLoginState);\n  useEffect(function () {\n    //Refresh JWT token or logout\n    refreshToken(); //Fetch articles\n\n    if (articles.length === 0) {\n      console.log('fetch articles');\n      disPatch(getArticles());\n    } //Fetch Load bookmarks and finished articles\n\n\n    var bookmarksJson = localStorage.getItem(\"bookmarks\");\n\n    if (bookmarksJson !== null) {\n      var bookmarksList = bookmarksJson.split(',');\n      disPatch(setBookmarks(bookmarksList.filter(function (bookmark) {\n        return bookmark !== '';\n      })));\n    }\n\n    var filterArticlesJson = localStorage.getItem(\"filterArticles\");\n\n    if (filterArticlesJson !== null) {\n      var filterArticlesList = filterArticlesJson.split(',');\n      disPatch(setFinishedArticles(filterArticlesList.filter(function (filterArticle) {\n        return filterArticle !== '';\n      })));\n    }\n  }, []);\n\n  var SetLogoutForLocalSorage = function SetLogoutForLocalSorage() {\n    localStorage.removeItem('login');\n    localStorage.removeItem('username');\n    localStorage.removeItem('email');\n    localStorage.removeItem('finishedArticles');\n    localStorage.removeItem('bookmarks');\n    localStorage.removeItem('token');\n    localStorage.removeItem('provider');\n  };\n\n  useEffect(function () {\n    console.log('articles updated');\n    var partialData = articles.slice(offset, offset + perpage);\n    disPatch(setPartialArticles(partialData));\n    var count = Math.ceil(articles.length / perpage);\n    disPatch(setPageCount(count));\n  }, [articles]);\n  useEffect(function () {\n    console.log('filtered articles updated');\n    var count = filteredArticles.length === 0 ? Math.ceil(articles.length / perpage) : Math.ceil(filteredArticles.length / perpage);\n    disPatch(setPageCount(count));\n    setPartialData();\n  }, [filteredArticles]);\n  useEffect(function () {\n    var count = filteredArticles.length === 0 ? Math.ceil(articles.length / perpage) : Math.ceil(filteredArticles.length / perpage);\n    disPatch(setPageCount(count));\n    setPartialData();\n    window.scrollTo(0, 0);\n  }, [offset]);\n\n  var refreshToken = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return axios.get('api/renew-token/');\n\n            case 3:\n              res = _context.sent;\n              _context.next = 11;\n              break;\n\n            case 6:\n              _context.prev = 6;\n              _context.t0 = _context[\"catch\"](0);\n              console.log(_context.t0);\n              SetLogout();\n              SetLogoutForLocalSorage();\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 6]]);\n    }));\n\n    return function refreshToken() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var SetLogout = function SetLogout() {\n    disPatch(setLogout());\n    disPatch(setUsername(''));\n    disPatch(setUserId(-1));\n    disPatch(setEmail(''));\n    disPatch(setFinishedArticles([]));\n    disPatch(setAccessToken(''));\n    disPatch(setProvider(''));\n    disPatch(setBookmarks([]));\n  };\n\n  var setPartialData = function setPartialData() {\n    var partialData = filteredArticles.length === 0 ? articles.slice(offset, offset + perpage) : filteredArticles.slice(offset, offset + perpage);\n    disPatch(setPartialArticles(partialData));\n  };\n\n  var handlePageSlected = function handlePageSlected(e) {\n    //Refresh JWT token or logout\n    refreshToken();\n    disPatch(setOffset(e.selected * perpage));\n  };\n\n  return __jsx(Fragment, null, __jsx(\"div\", {\n    className: \"\".concat(showPlanner === true ? 'articles-hide-siderbar-head' : 'articles-hide-siderbar-head articles-hide-siderbar-head-remove-left')\n  }, __jsx(\"div\", {\n    className: \"title\"\n  }, \"Learning materials (\".concat(filteredArticles.length === 0 ? articles.length : filteredArticles.length, \")\")), isLogin ? __jsx(\"div\", {\n    className: \"subtitle\"\n  }, \"Click the details button to check the article.\") : __jsx(\"div\", {\n    className: \"subtitle\"\n  }, __jsx(\"a\", {\n    href: \"/signin\"\n  }, \"Login \"), \"to add articles or skills in your learning plan or open them directly.\"), smallerThan800 && __jsx(ArticleSearchBar, null)), __jsx(\"div\", {\n    className: \"\".concat(showPlanner !== true ? 'articles-hide-siderbar' : 'articles-hide-siderbar articles-hide-siderbar-remove-left')\n  }, __jsx(\"div\", {\n    className: \"articles-row row\"\n  }, articles.length === 0 ? __jsx(\"div\", {\n    className: \"articles-spinner\"\n  }, __jsx(Spinner, {\n    animation: \"border\",\n    role: \"status\"\n  }, __jsx(\"span\", {\n    className: \"sr-only\"\n  }, \"Loading...\"))) : partialArticles.map(function (article) {\n    return __jsx(TransitionGroup, null, __jsx(CSSTransition, {\n      key: article.id,\n      timeout: 500,\n      classNames: \"item\"\n    }, __jsx(Article, {\n      key: article.id,\n      article: article\n    })));\n  })), partialArticles.length > 0 && __jsx(\"div\", {\n    className: \"article-pagination\"\n  }, __jsx(ReactPaginate, {\n    previousLabel: \"prev\",\n    nextLabel: \"next\",\n    breakLabel: \"...\",\n    breakClassName: \"break-me\",\n    pageCount: pageCount,\n    marginPagesDisplayed: 2,\n    pageRangeDisplayed: 5,\n    onPageChange: handlePageSlected,\n    containerClassName: \"pagination\",\n    subContainerClassName: \"pages pagination\",\n    activeClassName: \"active\"\n  })), partialArticles.length > 0 && __jsx(Footer, null)));\n};\n\nexport default ArticleList;","map":null,"metadata":{},"sourceType":"module"}