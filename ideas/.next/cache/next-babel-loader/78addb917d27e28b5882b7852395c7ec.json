{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { Fragment, useState, useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport FacebookLogin from 'react-facebook-login/dist/facebook-login-render-props'; //import { GoogleLogin } from 'react-google-login';\n\nimport GitHubLogin from 'react-github-login';\nimport '.././css/signinform.css';\nimport axios from 'axios';\nimport { Form, Spinner } from 'react-bootstrap';\nimport { selectShowPlannerState, selectErrorMessageState, selectLoadingState, selectUserIdState, selectLoginState } from './states/states';\nimport FormWrapper from '../components/FormWrapper';\nimport { setErrorMessage, setLoading, setUserId, setBookmarks } from './actions/articlesAction';\n\nconst SignInForm = ({\n  responseFacebook,\n  ResponseGithubOnSuccess,\n  ResponseGithubOnFailure,\n  SetLogin\n}) => {\n  const disPatch = useDispatch();\n  const showPlanner = useSelector(selectShowPlannerState);\n  const errorMessage = useSelector(selectErrorMessageState);\n  const isLoading = useSelector(selectLoadingState);\n  const userId = useSelector(selectUserIdState);\n  const login = useSelector(selectLoginState);\n  const {\n    0: value,\n    1: setValue\n  } = useState({\n    username: '',\n    password: ''\n  });\n  const {\n    username,\n    password\n  } = value;\n\n  const handleChange = name => e => {\n    setValue(_objectSpread(_objectSpread({}, value), {}, {\n      [name]: e.target.value.trim()\n    }));\n  };\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n    console.log(username);\n    console.log(password);\n\n    try {\n      disPatch(setLoading(true));\n      const res = await axios.post('/api/token-auth/', {\n        username: username,\n        password: password\n      });\n      console.log(res);\n      console.log(res[\"data\"][\"user\"][\"profile\"]);\n      const token = res[\"data\"][\"token\"];\n      const email = res[\"data\"][\"user\"][\"profile\"][\"email\"];\n      const id = res[\"data\"][\"user\"][\"id\"];\n      SetLogin(token, email, username, \"normal\");\n      disPatch(setUserId(id));\n      disPatch(setLoading(false));\n    } catch (error) {\n      disPatch(setLoading(false));\n      disPatch(setErrorMessage(error.message));\n    }\n  };\n\n  useEffect(() => {\n    const fetchProfile = async () => {\n      try {\n        const res = await axios.get(`api/profile/?reader=${userId}`);\n\n        if (res['error'] === undefined) {\n          console.log(res);\n          const bookmarksList = res['data']['bookmarks'].split(',');\n          console.log(bookmarksList.filter(bookmark => bookmark !== ''));\n          disPatch(setBookmarks(bookmarksList.filter(bookmark => bookmark !== '')));\n          localStorage.setItem(\"bookmarks\", res['data']['bookmarks'].trim());\n          const finishedArticlesList = res['data']['finishedArticles'].split(',');\n          disPatch(setBookmarks(finishedArticlesList.filter(finishedArticle => finishedArticle !== '')));\n          localStorage.setItem(\"finishedArticles\", res['data']['finishedArticles'].trim());\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    };\n\n    if (login) {\n      fetchProfile();\n    }\n  }, [userId, login]);\n  return __jsx(Fragment, null, __jsx(\"div\", {\n    className: `${showPlanner === true ? 'signinform-move-left signinform' : 'signinform'}`\n  }, isLoading === true ? __jsx(\"div\", {\n    className: \"signinform-grid-box\"\n  }, __jsx(\"div\", {\n    className: \"signinform-spinner\"\n  }, __jsx(Spinner, {\n    animation: \"border\",\n    role: \"status\"\n  }, __jsx(\"span\", {\n    className: \"sr-only\"\n  }, \"Loading...\")))) : __jsx(\"div\", {\n    className: \"signinform-grid-box\"\n  }, __jsx(\"div\", {\n    className: \"title\"\n  }, \"Welcome back!\"), __jsx(FacebookLogin, {\n    cssClass: \"fb-btn\",\n    appId: \"240314257268798\",\n    autoLoad: false,\n    fields: \"name,email,picture\",\n    callback: responseFacebook,\n    render: renderProps => __jsx(\"button\", {\n      onClick: renderProps.onClick,\n      className: \"fb-btn\"\n    }, \"Facebook\")\n  }), __jsx(GitHubLogin, {\n    className: \"github-btn\",\n    clientId: \"51b1a8ee5b7cad1e6a85\",\n    redirectUri: \"http://localhost:8000/signin\",\n    onSuccess: ResponseGithubOnSuccess,\n    onFailure: ResponseGithubOnFailure,\n    buttonText: \"Github\"\n  }), __jsx(\"div\", {\n    className: \"split-line\"\n  }, \"Or signin by username\"), __jsx(\"div\", {\n    className: \"signin-form\"\n  }, __jsx(Form, {\n    onSubmit: handleSubmit\n  }, __jsx(Form.Group, {\n    controlId: \"formBasicEmail\"\n  }, __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Enter Username\",\n    className: \"username\",\n    onChange: handleChange('username')\n  })), __jsx(Form.Group, {\n    controlId: \"formBasicPassword\"\n  }, __jsx(Form.Control, {\n    type: \"password\",\n    placeholder: \"Password\",\n    className: \"password\",\n    onChange: handleChange('password')\n  })), __jsx(\"button\", {\n    className: \"btn-submit\"\n  }, \"Sign in\"))), __jsx(\"div\", {\n    className: \"messages\"\n  }, errorMessage))));\n};\n\nexport default FormWrapper(SignInForm);","map":null,"metadata":{},"sourceType":"module"}