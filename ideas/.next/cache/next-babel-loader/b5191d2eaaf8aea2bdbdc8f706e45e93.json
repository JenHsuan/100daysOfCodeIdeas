{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport { Card } from 'react-bootstrap';\nimport ArticleModal from '../components/ArticleModal';\nimport '.././css/article.css';\nimport '.././css/card.css';\nimport { selectLoginState, selectBookmarksState, selectProviderState, selectUserIdState, selectEmailState, selectFinishedArticlessState } from './states/states';\nimport { setBookmarks, setFinishedArticles } from './actions/articlesAction';\nimport Router, { useRouter } from 'next/router';\nimport axios from 'axios';\n\nconst Article = ({\n  article\n}) => {\n  const router = useRouter();\n  const disPatch = useDispatch();\n  const {\n    0: show,\n    1: setShow\n  } = useState(false);\n  const {\n    0: isBookmarked,\n    1: setBookmark\n  } = useState(false);\n  const {\n    0: isChecked,\n    1: setChecked\n  } = useState(false);\n  const isLogin = useSelector(selectLoginState);\n  const bookmarks = useSelector(selectBookmarksState);\n  const userId = useSelector(selectUserIdState);\n  const provider = useSelector(selectProviderState);\n  const email = useSelector(selectEmailState);\n  const finishedArticles = useSelector(selectFinishedArticlessState);\n  useEffect(() => {\n    if (bookmarks.find(bookmark => bookmark == String(article.id)) !== undefined) {\n      console.log('bookmark');\n      setBookmark(true);\n    }\n  }, [bookmarks]);\n  useEffect(() => {\n    if (finishedArticles.find(finishedArticle => finishedArticle === article.id) !== undefined) {\n      console.log('finishedArticle');\n      setChecked(true);\n    }\n  }, [finishedArticles]);\n\n  const handleClose = () => {\n    setShow(false);\n  };\n\n  const handleShow = () => {\n    setShow(true);\n  };\n\n  const handleCheckingTrue = async () => {\n    let finishedArticlesString = localStorage.getItem(\"finishedArticles\");\n    let finishedArticlesList;\n    let localfinishedArticles;\n\n    if (finishedArticlesString === '') {\n      localfinishedArticles = `${article.id}`;\n      finishedArticlesList = [article.id];\n    } else {\n      finishedArticlesList = finishedArticlesString.split(',');\n      finishedArticlesList.indexOf(article.id) === -1 ? finishedArticlesList.push(article.id) : console.log(\"This item already exists\");\n    } //set bookmarks to local state\n\n\n    setChecked(true);\n    let newfinishedArticlesString = finishedArticlesList.join(); //set bookmarks to localStorage\n\n    localStorage.setItem(\"finishedArticles\", newfinishedArticlesString); //set bookmarks to global state\n\n    disPatch(setFinishedArticles(finishedArticlesList)); //update server\n\n    if (provider === 'normal') {\n      try {\n        const res = await axios.put(`api/profile/?finishedArticles=${newfinishedArticlesString}&reader_id=${userId}`);\n      } catch (error) {\n        console.log(error);\n      }\n    } else {\n      try {\n        const res = await axios.put(`api/profilesocial/?finishedArticles=${newfinishedArticlesString}&email=${email}&provider=${provider}`);\n      } catch (error) {\n        console.log(error);\n      }\n    }\n  };\n\n  const handleCheckingFalse = async () => {\n    let finishedArticlesString = localStorage.getItem(\"finishedArticles\");\n\n    if (isChecked) {\n      if (finishedArticlesString !== null) {\n        let finishedArticlesList = finishedArticlesString.split(',');\n        finishedArticlesList = finishedArticlesList.filter(finishedArticle => Number(finishedArticle) !== article.id);\n        let newfinishedArticlesString = finishedArticlesList.join(); //set bookmarks to localStorage\n\n        localStorage.setItem(\"finishedArticles\", newfinishedArticlesString); //set bookmarks to global state\n\n        disPatch(setFinishedArticles(finishedArticlesList)); //update server\n\n        if (provider === 'normal') {\n          try {\n            const res = await axios.put(`api/profile/?finishedArticles=${newfinishedArticlesString}&reader_id=${userId}`);\n          } catch (error) {\n            console.log(error);\n          }\n        } else {\n          try {\n            const res = await axios.put(`api/profilesocial/?finishedArticles=${newfinishedArticlesString}&email=${email}&provider=${provider}`);\n          } catch (error) {\n            console.log(error);\n          }\n        }\n      } //set bookmarks to local state\n\n\n      setChecked(false);\n    }\n  };\n\n  const setBookmarksState = async bookmarksList => {\n    let newbookmarksString = bookmarksList.join(); //set bookmarks to localStorage\n\n    localStorage.setItem(\"bookmarks\", newbookmarksString); //set bookmarks to global state\n\n    disPatch(setBookmarks(bookmarksList)); //update server\n\n    if (provider === 'normal') {\n      try {\n        const res = await axios.put(`api/profile/?bookmarks=${newbookmarksString}&reader_id=${userId}`);\n      } catch (error) {\n        console.log(error);\n      }\n    } else {\n      try {\n        const res = await axios.put(`api/profilesocial/?bookmarks=${newbookmarksString}&email=${email}&provider=${localStorage.getItem(\"provider\")}`);\n      } catch (error) {\n        console.log(error);\n      }\n    }\n  };\n\n  const onBookmarkClick = async () => {\n    let bookmarksString = localStorage.getItem(\"bookmarks\");\n    let localBookmarks;\n    let bookmarksList;\n\n    if (isBookmarked) {\n      if (bookmarksString !== null) {\n        bookmarksList = bookmarksString.split(',');\n        bookmarksList = bookmarksList.filter(bookmark => Number(bookmark) !== article.id);\n      } //set bookmarks to local state\n\n\n      setBookmark(false);\n      await setBookmarksState(bookmarksList);\n    } else {\n      if (bookmarksString === '') {\n        console.log(999);\n        localBookmarks = `${article.id}`;\n        bookmarksList = [article.id];\n      } else {\n        bookmarksList = bookmarksString.split(',');\n        bookmarksList.indexOf(article.id) === -1 ? bookmarksList.push(article.id) : console.log(\"This item already exists\");\n      } //set bookmarks to local state\n\n\n      setBookmark(true);\n      await setBookmarksState(bookmarksList); //redirect\n\n      if (router.pathname !== 'bookmarks') {\n        Router.push(`/bookmarks`);\n      }\n    }\n  };\n\n  useEffect(() => {}, []);\n  return __jsx(\"div\", {\n    className: \"articles-row\"\n  }, __jsx(Card, {\n    className: \"article-card\",\n    border: \"light\"\n  }, isLogin && router.pathname !== '/bookmarks' && __jsx(\"div\", {\n    className: \"article-bookmark\"\n  }, __jsx(\"span\", {\n    className: \"btn-o\"\n  }, __jsx(\"a\", {\n    href: \"#\",\n    onClick: () => {\n      onBookmarkClick();\n      return false;\n    }\n  }, isBookmarked ? __jsx(\"img\", {\n    src: \"https://raw.githubusercontent.com/JenHsuan/ALayman/master/views/images/bookmark-yellow.png\",\n    alt: \"Add this article to the bookmark\",\n    title: \"Add this article to the bookmark\"\n  }) : __jsx(\"img\", {\n    src: \"https://raw.githubusercontent.com/JenHsuan/ALayman/master/views/images/bookmark-white.png\",\n    alt: \"Add this article to the bookmark\",\n    title: \"Add this article to the bookmark\"\n  })))), router.pathname === '/bookmarks' && __jsx(\"div\", {\n    className: \"article-checked\"\n  }, __jsx(\"span\", {\n    className: \"btn-o\"\n  }, __jsx(\"a\", {\n    href: \"#\",\n    onClick: () => {\n      handleCheckingFalse();\n      return false;\n    }\n  }, isChecked ? __jsx(\"img\", {\n    src: \"https://raw.githubusercontent.com/JenHsuan/ALayman/master/views/images/check.png\",\n    alt: \"Marked as unfinished\",\n    title: \"Marked as unfinished\"\n  }) : __jsx(\"img\", {\n    src: \"https://raw.githubusercontent.com/JenHsuan/ALayman/master/views/images/uncheck.png\",\n    alt: \"Marked as finished\",\n    title: \"Marked as finished\"\n  })))), __jsx(Card.Body, {\n    className: \"article-card-body\"\n  }, __jsx(\"img\", {\n    className: \"article-card-img\",\n    src: `${article.image}`,\n    alt: article.title,\n    title: article.title\n  }), __jsx(\"div\", {\n    className: \"title\"\n  }, article.title), __jsx(\"div\", {\n    className: \"date\"\n  }, article.name), __jsx(\"div\", {\n    className: \"date\"\n  }, __jsx(\"span\", {\n    className: \"date\"\n  }, article.time), __jsx(\"span\", null, \" . \"), __jsx(\"span\", {\n    className: \"readtime\"\n  }, article.readtime)), __jsx(\"button\", {\n    className: \"article-btn\",\n    onClick: handleShow\n  }, \"Details\"))), __jsx(ArticleModal, {\n    show: show,\n    handleClose: handleClose,\n    article: article,\n    handleOpen: handleCheckingTrue\n  }));\n};\n\nArticle.propTypes = {\n  article: PropTypes.object.isRequired\n};\nexport default Article;","map":{"version":3,"sources":["/Users/seanhsieh/github/100daysOfCodeIdeas/ideas/src/components/Article.tsx"],"names":["React","useEffect","useState","useDispatch","useSelector","PropTypes","Card","ArticleModal","selectLoginState","selectBookmarksState","selectProviderState","selectUserIdState","selectEmailState","selectFinishedArticlessState","setBookmarks","setFinishedArticles","Router","useRouter","axios","Article","article","router","disPatch","show","setShow","isBookmarked","setBookmark","isChecked","setChecked","isLogin","bookmarks","userId","provider","email","finishedArticles","find","bookmark","String","id","undefined","console","log","finishedArticle","handleClose","handleShow","handleCheckingTrue","finishedArticlesString","localStorage","getItem","finishedArticlesList","localfinishedArticles","split","indexOf","push","newfinishedArticlesString","join","setItem","res","put","error","handleCheckingFalse","filter","Number","setBookmarksState","bookmarksList","newbookmarksString","onBookmarkClick","bookmarksString","localBookmarks","pathname","image","title","name","time","readtime","propTypes","object","isRequired"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from 'react'\nimport { useDispatch, useSelector } from 'react-redux';\nimport PropTypes from 'prop-types'\nimport { Card} from 'react-bootstrap';\nimport ArticleModal from '../components/ArticleModal';\nimport '.././css/article.css'\nimport '.././css/card.css'\nimport {\n    selectLoginState,\n    selectBookmarksState,\n    selectProviderState,\n    selectUserIdState,\n    selectEmailState,\n    selectFinishedArticlessState\n} from './states/states';\n\nimport { \n    setBookmarks,\n    removeBookmark,\n    setFinishedArticles,\n    removeFinishedArticle\n} from './actions/articlesAction';\nimport Router, { useRouter } from 'next/router'\nimport axios from 'axios';\n\nconst Article = ({article}) => {\n    const router = useRouter();\n    const disPatch = useDispatch();\n    const [show, setShow] = useState(false);\n    const [isBookmarked, setBookmark] = useState(false);\n    const [isChecked, setChecked] = useState(false);\n    const isLogin = useSelector(selectLoginState);\n    const bookmarks = useSelector(selectBookmarksState);\n    const userId = useSelector(selectUserIdState);\n    const provider = useSelector(selectProviderState);\n    const email = useSelector(selectEmailState);\n    const finishedArticles = useSelector(selectFinishedArticlessState);\n\n    useEffect(()=> {\n\n        if (bookmarks.find(bookmark => bookmark == String(article.id)) !== undefined) {\n            console.log('bookmark')\n            setBookmark(true);\n        }\n    }, [bookmarks])\n\n    useEffect(()=> {\n        if (finishedArticles.find(finishedArticle => finishedArticle === article.id) !== undefined ) {\n            console.log('finishedArticle')\n            setChecked(true);\n        }\n    }, [finishedArticles])\n\n    const handleClose = () => {\n        setShow(false);\n    }\n\n    const handleShow = () => {\n        setShow(true);\n    }\n\n    const handleCheckingTrue = async () => {\n        let finishedArticlesString = localStorage.getItem(\"finishedArticles\");\n        let finishedArticlesList;\n        let localfinishedArticles;\n        if (finishedArticlesString === '') {\n            localfinishedArticles = `${article.id}`;\n            finishedArticlesList = [article.id];\n        } else {\n            finishedArticlesList = finishedArticlesString.split(',');\n            finishedArticlesList.indexOf(article.id) === -1 ? finishedArticlesList.push(article.id) : console.log(\"This item already exists\");\n        }\n        //set bookmarks to local state\n        setChecked(true);\n\n        let newfinishedArticlesString = finishedArticlesList.join();\n        //set bookmarks to localStorage\n        localStorage.setItem(\"finishedArticles\", newfinishedArticlesString);\n        //set bookmarks to global state\n        disPatch(setFinishedArticles(finishedArticlesList));\n        //update server\n        if (provider === 'normal') {\n            try {\n                const res = await axios.put(`api/profile/?finishedArticles=${newfinishedArticlesString}&reader_id=${userId}`);\n            } catch(error) {\n                console.log(error)\n            }\n        } else {\n            try {\n                const res = await axios.put(`api/profilesocial/?finishedArticles=${newfinishedArticlesString}&email=${email}&provider=${provider}`);\n            } catch(error) {\n                console.log(error)\n            }\n        }\n    }\n\n    const handleCheckingFalse = async() => {\n        let finishedArticlesString = localStorage.getItem(\"finishedArticles\");\n        if (isChecked) {\n            if (finishedArticlesString !== null) {\n                let finishedArticlesList = finishedArticlesString.split(',');\n                finishedArticlesList = finishedArticlesList.filter(finishedArticle => Number(finishedArticle) !== article.id);\n                let newfinishedArticlesString = finishedArticlesList.join();\n                //set bookmarks to localStorage\n                localStorage.setItem(\"finishedArticles\", newfinishedArticlesString);\n                //set bookmarks to global state\n                disPatch(setFinishedArticles(finishedArticlesList));\n                //update server\n                if (provider === 'normal') {\n                    try {\n                        const res = await axios.put(`api/profile/?finishedArticles=${newfinishedArticlesString}&reader_id=${userId}`);\n                    } catch(error) {\n                        console.log(error)\n                    }\n                } else {\n                    try {\n                        const res = await axios.put(`api/profilesocial/?finishedArticles=${newfinishedArticlesString}&email=${email}&provider=${provider}`);\n                    } catch(error) {\n                        console.log(error)\n                    }\n                }\n            }\n            //set bookmarks to local state\n            setChecked(false);\n        }\n\n        \n    }\n\n    const setBookmarksState = async (bookmarksList) => { \n        let newbookmarksString = bookmarksList.join();\n        //set bookmarks to localStorage\n        localStorage.setItem(\"bookmarks\", newbookmarksString);\n        //set bookmarks to global state\n        disPatch(setBookmarks(bookmarksList));\n        //update server\n        if (provider === 'normal') {\n            try {\n                const res = await axios.put(`api/profile/?bookmarks=${newbookmarksString}&reader_id=${userId}`);\n            } catch(error) {\n                console.log(error)\n            }\n        } else {\n            try {\n                const res = await axios.put(`api/profilesocial/?bookmarks=${newbookmarksString}&email=${email}&provider=${localStorage.getItem(\"provider\")}`);\n            } catch(error) {\n                console.log(error)\n            }\n        }\n    }\n    const onBookmarkClick = async () => {\n        let bookmarksString = localStorage.getItem(\"bookmarks\");\n        let localBookmarks;\n        let bookmarksList;\n        if (isBookmarked) {\n            if (bookmarksString !== null) {\n                bookmarksList = bookmarksString.split(',');\n                bookmarksList = bookmarksList.filter(bookmark => Number(bookmark) !== article.id);\n            }\n            //set bookmarks to local state\n            setBookmark(false);\n\n            await setBookmarksState(bookmarksList);\n        } else {\n            if (bookmarksString === '') {\n                console.log(999)\n                localBookmarks = `${article.id}`;\n                bookmarksList = [article.id];\n            } else {\n                bookmarksList = bookmarksString.split(',');\n                bookmarksList.indexOf(article.id) === -1 ? bookmarksList.push(article.id) : console.log(\"This item already exists\");\n            }\n            //set bookmarks to local state\n            setBookmark(true);\n\n            await setBookmarksState(bookmarksList);\n            //redirect\n            if (router.pathname !== 'bookmarks') {\n                Router.push(`/bookmarks`)\n            }\n        }\n        \n        \n    }\n\n    useEffect(()=> {\n    }, [])\n\n    return (\n        <div className=\"articles-row\">\n            <Card className=\"article-card\" border=\"light\">\n                {isLogin && router.pathname !== '/bookmarks' && (\n                <div className=\"article-bookmark\">\n                    <span className=\"btn-o\">\n                        <a href='#' onClick={()=>{onBookmarkClick(); return false;}}>\n                            {isBookmarked \n                            ? <img src=\"https://raw.githubusercontent.com/JenHsuan/ALayman/master/views/images/bookmark-yellow.png\" alt=\"Add this article to the bookmark\" title=\"Add this article to the bookmark\"/>\n                            : <img src=\"https://raw.githubusercontent.com/JenHsuan/ALayman/master/views/images/bookmark-white.png\" alt=\"Add this article to the bookmark\" title=\"Add this article to the bookmark\"/>\n                            }\n                        </a>\n                    </span>\n                </div>\n                )}\n                {router.pathname === '/bookmarks' && (\n                <div className=\"article-checked\">\n                    <span className=\"btn-o\">\n                        <a href='#' onClick={()=>{handleCheckingFalse(); return false;}}>\n                            {isChecked\n                            ? <img src=\"https://raw.githubusercontent.com/JenHsuan/ALayman/master/views/images/check.png\" alt=\"Marked as unfinished\" title=\"Marked as unfinished\"/>\n                            : <img src=\"https://raw.githubusercontent.com/JenHsuan/ALayman/master/views/images/uncheck.png\" alt=\"Marked as finished\" title=\"Marked as finished\"/>\n                        }\n                        </a>\n                    </span>\n                </div>\n                )}\n                <Card.Body className=\"article-card-body\">\n                    <img className=\"article-card-img\" src={`${article.image}`} alt={article.title} title={article.title}/>\n                    <div className=\"title\">{article.title}</div>\n                    <div className=\"date\">{article.name}</div>\n                    <div className=\"date\">\n                        <span className=\"date\">{article.time}</span>\n                        <span> . </span>\n                        <span className=\"readtime\">{article.readtime}</span>\n                    </div>\n                    <button className=\"article-btn\" onClick = {handleShow}>Details</button>\n                </Card.Body>\n            </Card>\n            <ArticleModal show = {show} handleClose = {handleClose} article = {article} handleOpen={handleCheckingTrue}/>\n        </div>\n    \n    )\n}\n\nArticle.propTypes = {\n    article: PropTypes.object.isRequired\n}\n\nexport default Article\n"]},"metadata":{},"sourceType":"module"}