{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport { Card } from 'react-bootstrap';\nimport ArticleModal from '../components/ArticleModal';\nimport '.././css/article.css';\nimport '.././css/card.css';\nimport { selectLoginState, selectBookmarksState, selectProviderState, selectUserIdState, selectEmailState, selectFinishedArticlessState } from './states/states';\nimport { setBookmarks, setFinishedArticles } from './actions/articlesAction';\nimport Router, { useRouter } from 'next/router';\nimport axios from 'axios';\n\nvar Article = function Article(_ref) {\n  _s();\n\n  var article = _ref.article;\n  var router = useRouter();\n  var disPatch = useDispatch();\n\n  var _useState = useState(false),\n      show = _useState[0],\n      setShow = _useState[1];\n\n  var _useState2 = useState(false),\n      isBookmarked = _useState2[0],\n      setBookmark = _useState2[1];\n\n  var _useState3 = useState(false),\n      isChecked = _useState3[0],\n      setChecked = _useState3[1];\n\n  var isLogin = useSelector(selectLoginState);\n  var bookmarks = useSelector(selectBookmarksState);\n  var userId = useSelector(selectUserIdState);\n  var provider = useSelector(selectProviderState);\n  var email = useSelector(selectEmailState);\n  var finishedArticles = useSelector(selectFinishedArticlessState);\n  useEffect(function () {\n    if (bookmarks.find(function (bookmark) {\n      return bookmark == article.id;\n    }) !== undefined) {\n      console.log('bookmark');\n      setBookmark(true);\n    }\n  }, [bookmarks]);\n  useEffect(function () {\n    if (finishedArticles.find(function (finishedArticle) {\n      return finishedArticle == article.id;\n    }) !== undefined) {\n      console.log('finishedArticle');\n      setChecked(true);\n    }\n  }, [finishedArticles]);\n\n  var handleClose = function handleClose() {\n    setShow(false);\n  };\n\n  var handleShow = function handleShow() {\n    setShow(true);\n  };\n\n  var handleCheckingTrue = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var finishedArticlesString, finishedArticlesList, localfinishedArticles, newfinishedArticlesString, res, _res;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              finishedArticlesString = localStorage.getItem(\"finishedArticles\");\n\n              if (finishedArticlesString === '') {\n                console.log(999);\n                localfinishedArticles = \"\".concat(article.id);\n                finishedArticlesList = [article.id];\n              } else {\n                finishedArticlesList = finishedArticlesString.split(',');\n                finishedArticlesList.indexOf(article.id) === -1 ? finishedArticlesList.push(article.id) : console.log(\"This item already exists\");\n              } //set bookmarks to local state\n\n\n              setChecked(true);\n              newfinishedArticlesString = finishedArticlesList.join(); //set bookmarks to localStorage\n\n              localStorage.setItem(\"finishedArticles\", newfinishedArticlesString); //set bookmarks to global state\n\n              disPatch(setFinishedArticles(finishedArticlesList)); //update server\n\n              if (!(provider === 'normal')) {\n                _context.next = 18;\n                break;\n              }\n\n              _context.prev = 7;\n              _context.next = 10;\n              return axios.put(\"api/profile/?finishedArticles=\".concat(newfinishedArticlesString, \"&reader_id=\").concat(userId));\n\n            case 10:\n              res = _context.sent;\n              _context.next = 16;\n              break;\n\n            case 13:\n              _context.prev = 13;\n              _context.t0 = _context[\"catch\"](7);\n              console.log(_context.t0);\n\n            case 16:\n              _context.next = 27;\n              break;\n\n            case 18:\n              _context.prev = 18;\n              _context.next = 21;\n              return axios.put(\"api/profilesocial/?finishedArticles=\".concat(newfinishedArticlesString, \"&email=\").concat(email, \"&provider=\").concat(provider));\n\n            case 21:\n              _res = _context.sent;\n              _context.next = 27;\n              break;\n\n            case 24:\n              _context.prev = 24;\n              _context.t1 = _context[\"catch\"](18);\n              console.log(_context.t1);\n\n            case 27:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[7, 13], [18, 24]]);\n    }));\n\n    return function handleCheckingTrue() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleCheckingFalse = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var finishedArticlesString, finishedArticlesList, localfinishedArticles, newfinishedArticlesString, res, _res2;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              finishedArticlesString = localStorage.getItem(\"finishedArticles\");\n\n              if (isChecked) {\n                if (finishedArticlesString !== null) {\n                  finishedArticlesList = finishedArticlesString.split(',');\n                  finishedArticlesList = finishedArticlesList.filter(function (finishedArticle) {\n                    return Number(finishedArticle) !== article.id;\n                  });\n                } //set bookmarks to local state\n\n\n                setChecked(false);\n              }\n\n              newfinishedArticlesString = finishedArticlesList.join(); //set bookmarks to localStorage\n\n              localStorage.setItem(\"finishedArticles\", newfinishedArticlesString); //set bookmarks to global state\n\n              disPatch(setFinishedArticles(finishedArticlesList)); //update server\n\n              if (!(provider === 'normal')) {\n                _context2.next = 17;\n                break;\n              }\n\n              _context2.prev = 6;\n              _context2.next = 9;\n              return axios.put(\"api/profile/?finishedArticles=\".concat(newfinishedArticlesString, \"&reader_id=\").concat(userId));\n\n            case 9:\n              res = _context2.sent;\n              _context2.next = 15;\n              break;\n\n            case 12:\n              _context2.prev = 12;\n              _context2.t0 = _context2[\"catch\"](6);\n              console.log(_context2.t0);\n\n            case 15:\n              _context2.next = 26;\n              break;\n\n            case 17:\n              _context2.prev = 17;\n              _context2.next = 20;\n              return axios.put(\"api/profilesocial/?finishedArticles=\".concat(newfinishedArticlesString, \"&email=\").concat(email, \"&provider=\").concat(provider));\n\n            case 20:\n              _res2 = _context2.sent;\n              _context2.next = 26;\n              break;\n\n            case 23:\n              _context2.prev = 23;\n              _context2.t1 = _context2[\"catch\"](17);\n              console.log(_context2.t1);\n\n            case 26:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[6, 12], [17, 23]]);\n    }));\n\n    return function handleCheckingFalse() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var setBookmarksState = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(bookmarksList) {\n      var newbookmarksString, res, _res3;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              newbookmarksString = bookmarksList.join(); //set bookmarks to localStorage\n\n              localStorage.setItem(\"bookmarks\", newbookmarksString); //set bookmarks to global state\n\n              disPatch(setBookmarks(bookmarksList)); //update server\n\n              if (!(provider === 'normal')) {\n                _context3.next = 15;\n                break;\n              }\n\n              _context3.prev = 4;\n              _context3.next = 7;\n              return axios.put(\"api/profile/?bookmarks=\".concat(newbookmarksString, \"&reader_id=\").concat(userId));\n\n            case 7:\n              res = _context3.sent;\n              _context3.next = 13;\n              break;\n\n            case 10:\n              _context3.prev = 10;\n              _context3.t0 = _context3[\"catch\"](4);\n              console.log(_context3.t0);\n\n            case 13:\n              _context3.next = 24;\n              break;\n\n            case 15:\n              _context3.prev = 15;\n              _context3.next = 18;\n              return axios.put(\"api/profilesocial/?bookmarks=\".concat(newbookmarksString, \"&email=\").concat(email, \"&provider=\").concat(provider));\n\n            case 18:\n              _res3 = _context3.sent;\n              _context3.next = 24;\n              break;\n\n            case 21:\n              _context3.prev = 21;\n              _context3.t1 = _context3[\"catch\"](15);\n              console.log(_context3.t1);\n\n            case 24:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[4, 10], [15, 21]]);\n    }));\n\n    return function setBookmarksState(_x) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var onBookmarkClick = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var bookmarksString, localBookmarks, bookmarksList;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              bookmarksString = localStorage.getItem(\"bookmarks\");\n\n              if (!isBookmarked) {\n                _context4.next = 8;\n                break;\n              }\n\n              if (bookmarksString !== null) {\n                bookmarksList = bookmarksString.split(',');\n                bookmarksList = bookmarksList.filter(function (bookmark) {\n                  return Number(bookmark) !== article.id;\n                });\n              } //set bookmarks to local state\n\n\n              setBookmark(false);\n              _context4.next = 6;\n              return setBookmarksState(bookmarksList);\n\n            case 6:\n              _context4.next = 14;\n              break;\n\n            case 8:\n              console.log(bookmarksString);\n\n              if (bookmarksString === '') {\n                console.log(999);\n                localBookmarks = \"\".concat(article.id);\n                bookmarksList = [article.id];\n              } else {\n                bookmarksList = bookmarksString.split(',');\n                bookmarksList.indexOf(article.id) === -1 ? bookmarksList.push(article.id) : console.log(\"This item already exists\");\n              } //set bookmarks to local state\n\n\n              setBookmark(true);\n              _context4.next = 13;\n              return setBookmarksState(bookmarksList);\n\n            case 13:\n              //redirect\n              if (router.pathname !== 'bookmarks') {\n                Router.push(\"/bookmarks\");\n              }\n\n            case 14:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function onBookmarkClick() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {}, []);\n  return __jsx(\"div\", {\n    className: \"articles-row\"\n  }, __jsx(Card, {\n    className: \"article-card\",\n    border: \"light\"\n  }, isLogin && router.pathname !== '/bookmarks' && __jsx(\"div\", {\n    className: \"article-bookmark\"\n  }, __jsx(\"span\", {\n    className: \"btn-o\"\n  }, __jsx(\"a\", {\n    href: \"#\",\n    onClick: function onClick() {\n      onBookmarkClick();\n      return false;\n    }\n  }, isBookmarked ? __jsx(\"img\", {\n    src: \"https://raw.githubusercontent.com/JenHsuan/ALayman/master/views/images/bookmark-yellow.png\",\n    alt: \"Add this article to the bookmark\",\n    title: \"Add this article to the bookmark\"\n  }) : __jsx(\"img\", {\n    src: \"https://raw.githubusercontent.com/JenHsuan/ALayman/master/views/images/bookmark-white.png\",\n    alt: \"Add this article to the bookmark\",\n    title: \"Add this article to the bookmark\"\n  })))), router.pathname === '/bookmarks' && __jsx(\"div\", {\n    className: \"article-checked\"\n  }, __jsx(\"span\", {\n    className: \"btn-o\"\n  }, __jsx(\"a\", {\n    href: \"#\",\n    onClick: function onClick() {\n      handleCheckingFalse();\n      return false;\n    }\n  }, isChecked ? __jsx(\"img\", {\n    src: \"https://raw.githubusercontent.com/JenHsuan/ALayman/master/views/images/check.png\",\n    alt: \"Marked as unfinished\",\n    title: \"Marked as unfinished\"\n  }) : __jsx(\"img\", {\n    src: \"https://raw.githubusercontent.com/JenHsuan/ALayman/master/views/images/uncheck.png\",\n    alt: \"Marked as finished\",\n    title: \"Marked as finished\"\n  })))), __jsx(Card.Body, {\n    className: \"article-card-body\"\n  }, __jsx(\"img\", {\n    className: \"article-card-img\",\n    src: \"\".concat(article.image),\n    alt: article.title,\n    title: article.title\n  }), __jsx(\"div\", {\n    className: \"title\"\n  }, article.title), __jsx(\"div\", {\n    className: \"date\"\n  }, article.name), __jsx(\"div\", {\n    className: \"date\"\n  }, __jsx(\"span\", {\n    className: \"date\"\n  }, article.time), __jsx(\"span\", null, \" . \"), __jsx(\"span\", {\n    className: \"readtime\"\n  }, article.readtime)), __jsx(\"button\", {\n    className: \"article-btn\",\n    onClick: handleShow\n  }, \"Details\"))), __jsx(ArticleModal, {\n    show: show,\n    handleClose: handleClose,\n    article: article,\n    handleOpen: handleCheckingTrue\n  }));\n};\n\n_s(Article, \"edC8m0QL2tYcWLOBwVmpob9u5MQ=\", false, function () {\n  return [useRouter, useDispatch, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector];\n});\n\n_c = Article;\nArticle.propTypes = {\n  article: PropTypes.object.isRequired\n};\nexport default Article;\n\nvar _c;\n\n$RefreshReg$(_c, \"Article\");","map":{"version":3,"sources":["/Users/seanhsieh/github/100daysOfCodeIdeas/ideas/src/components/Article.tsx"],"names":["React","useEffect","useState","useDispatch","useSelector","PropTypes","Card","ArticleModal","selectLoginState","selectBookmarksState","selectProviderState","selectUserIdState","selectEmailState","selectFinishedArticlessState","setBookmarks","setFinishedArticles","Router","useRouter","axios","Article","article","router","disPatch","show","setShow","isBookmarked","setBookmark","isChecked","setChecked","isLogin","bookmarks","userId","provider","email","finishedArticles","find","bookmark","id","undefined","console","log","finishedArticle","handleClose","handleShow","handleCheckingTrue","finishedArticlesString","localStorage","getItem","localfinishedArticles","finishedArticlesList","split","indexOf","push","newfinishedArticlesString","join","setItem","put","res","handleCheckingFalse","filter","Number","setBookmarksState","bookmarksList","newbookmarksString","onBookmarkClick","bookmarksString","localBookmarks","pathname","image","title","name","time","readtime","propTypes","object","isRequired"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from 'react'\nimport { useDispatch, useSelector } from 'react-redux';\nimport PropTypes from 'prop-types'\nimport { Card} from 'react-bootstrap';\nimport ArticleModal from '../components/ArticleModal';\nimport '.././css/article.css'\nimport '.././css/card.css'\nimport {\n    selectLoginState,\n    selectBookmarksState,\n    selectProviderState,\n    selectUserIdState,\n    selectEmailState,\n    selectFinishedArticlessState\n} from './states/states';\n\nimport { \n    setBookmarks,\n    removeBookmark,\n    setFinishedArticles,\n    removeFinishedArticle\n} from './actions/articlesAction';\nimport Router, { useRouter } from 'next/router'\nimport axios from 'axios';\n\nconst Article = ({article}) => {\n    const router = useRouter();\n    const disPatch = useDispatch();\n    const [show, setShow] = useState(false);\n    const [isBookmarked, setBookmark] = useState(false);\n    const [isChecked, setChecked] = useState(false);\n    const isLogin = useSelector(selectLoginState);\n    const bookmarks = useSelector(selectBookmarksState);\n    const userId = useSelector(selectUserIdState);\n    const provider = useSelector(selectProviderState);\n    const email = useSelector(selectEmailState);\n    const finishedArticles = useSelector(selectFinishedArticlessState);\n\n    useEffect(()=> {\n        if (bookmarks.find(bookmark => bookmark == article.id) !== undefined ) {\n            console.log('bookmark')\n            setBookmark(true);\n        }\n    }, [bookmarks])\n\n    useEffect(()=> {\n        if (finishedArticles.find(finishedArticle => finishedArticle == article.id) !== undefined ) {\n            console.log('finishedArticle')\n            setChecked(true);\n        }\n    }, [finishedArticles])\n\n    const handleClose = () => {\n        setShow(false);\n    }\n\n    const handleShow = () => {\n        setShow(true);\n    }\n\n    const handleCheckingTrue = async () => {\n        let finishedArticlesString = localStorage.getItem(\"finishedArticles\");\n        let finishedArticlesList;\n        let localfinishedArticles;\n        if (finishedArticlesString === '') {\n            console.log(999)\n            localfinishedArticles = `${article.id}`;\n            finishedArticlesList = [article.id];\n        } else {\n            finishedArticlesList = finishedArticlesString.split(',');\n            finishedArticlesList.indexOf(article.id) === -1 ? finishedArticlesList.push(article.id) : console.log(\"This item already exists\");\n        }\n        //set bookmarks to local state\n        setChecked(true);\n\n        let newfinishedArticlesString = finishedArticlesList.join();\n        //set bookmarks to localStorage\n        localStorage.setItem(\"finishedArticles\", newfinishedArticlesString);\n        //set bookmarks to global state\n        disPatch(setFinishedArticles(finishedArticlesList));\n        //update server\n        if (provider === 'normal') {\n            try {\n                const res = await axios.put(`api/profile/?finishedArticles=${newfinishedArticlesString}&reader_id=${userId}`);\n            } catch(error) {\n                console.log(error)\n            }\n        } else {\n            try {\n                const res = await axios.put(`api/profilesocial/?finishedArticles=${newfinishedArticlesString}&email=${email}&provider=${provider}`);\n            } catch(error) {\n                console.log(error)\n            }\n        }\n    }\n\n    const handleCheckingFalse = async() => {\n        let finishedArticlesString = localStorage.getItem(\"finishedArticles\");\n        let finishedArticlesList;\n        let localfinishedArticles;\n        if (isChecked) {\n            if (finishedArticlesString !== null) {\n                finishedArticlesList = finishedArticlesString.split(',');\n                finishedArticlesList = finishedArticlesList.filter(finishedArticle => Number(finishedArticle) !== article.id);\n            }\n            //set bookmarks to local state\n            setChecked(false);\n        }\n\n        let newfinishedArticlesString = finishedArticlesList.join();\n        //set bookmarks to localStorage\n        localStorage.setItem(\"finishedArticles\", newfinishedArticlesString);\n        //set bookmarks to global state\n        disPatch(setFinishedArticles(finishedArticlesList));\n        //update server\n        if (provider === 'normal') {\n            try {\n                const res = await axios.put(`api/profile/?finishedArticles=${newfinishedArticlesString}&reader_id=${userId}`);\n            } catch(error) {\n                console.log(error)\n            }\n        } else {\n            try {\n                const res = await axios.put(`api/profilesocial/?finishedArticles=${newfinishedArticlesString}&email=${email}&provider=${provider}`);\n            } catch(error) {\n                console.log(error)\n            }\n        }\n    }\n\n    const setBookmarksState = async (bookmarksList) => { \n        let newbookmarksString = bookmarksList.join();\n        //set bookmarks to localStorage\n        localStorage.setItem(\"bookmarks\", newbookmarksString);\n        //set bookmarks to global state\n        disPatch(setBookmarks(bookmarksList));\n        //update server\n        if (provider === 'normal') {\n            try {\n                const res = await axios.put(`api/profile/?bookmarks=${newbookmarksString}&reader_id=${userId}`);\n            } catch(error) {\n                console.log(error)\n            }\n        } else {\n            try {\n                const res = await axios.put(`api/profilesocial/?bookmarks=${newbookmarksString}&email=${email}&provider=${provider}`);\n            } catch(error) {\n                console.log(error)\n            }\n        }\n    }\n    const onBookmarkClick = async () => {\n        let bookmarksString = localStorage.getItem(\"bookmarks\");\n        let localBookmarks;\n        let bookmarksList;\n        if (isBookmarked) {\n            if (bookmarksString !== null) {\n                bookmarksList = bookmarksString.split(',');\n                bookmarksList = bookmarksList.filter(bookmark => Number(bookmark) !== article.id);\n            }\n            //set bookmarks to local state\n            setBookmark(false);\n\n            await setBookmarksState(bookmarksList);\n        } else {\n            console.log(bookmarksString)\n            if (bookmarksString === '') {\n                console.log(999)\n                localBookmarks = `${article.id}`;\n                bookmarksList = [article.id];\n            } else {\n                bookmarksList = bookmarksString.split(',');\n                bookmarksList.indexOf(article.id) === -1 ? bookmarksList.push(article.id) : console.log(\"This item already exists\");\n            }\n            //set bookmarks to local state\n            setBookmark(true);\n\n            await  setBookmarksState(bookmarksList);\n            //redirect\n            if (router.pathname !== 'bookmarks') {\n                Router.push(`/bookmarks`)\n            }\n        }\n        \n        \n    }\n\n    useEffect(()=> {\n    }, [])\n\n    return (\n        <div className=\"articles-row\">\n            <Card className=\"article-card\" border=\"light\">\n                {isLogin && router.pathname !== '/bookmarks' && (\n                <div className=\"article-bookmark\">\n                    <span className=\"btn-o\">\n                        <a href='#' onClick={()=>{onBookmarkClick(); return false;}}>\n                            {isBookmarked \n                            ? <img src=\"https://raw.githubusercontent.com/JenHsuan/ALayman/master/views/images/bookmark-yellow.png\" alt=\"Add this article to the bookmark\" title=\"Add this article to the bookmark\"/>\n                            : <img src=\"https://raw.githubusercontent.com/JenHsuan/ALayman/master/views/images/bookmark-white.png\" alt=\"Add this article to the bookmark\" title=\"Add this article to the bookmark\"/>\n                            }\n                        </a>\n                    </span>\n                </div>\n                )}\n                {router.pathname === '/bookmarks' && (\n                <div className=\"article-checked\">\n                    <span className=\"btn-o\">\n                        <a href='#' onClick={()=>{handleCheckingFalse(); return false;}}>\n                            {isChecked\n                            ? <img src=\"https://raw.githubusercontent.com/JenHsuan/ALayman/master/views/images/check.png\" alt=\"Marked as unfinished\" title=\"Marked as unfinished\"/>\n                            : <img src=\"https://raw.githubusercontent.com/JenHsuan/ALayman/master/views/images/uncheck.png\" alt=\"Marked as finished\" title=\"Marked as finished\"/>\n                        }\n                        </a>\n                    </span>\n                </div>\n                )}\n                <Card.Body className=\"article-card-body\">\n                    <img className=\"article-card-img\" src={`${article.image}`} alt={article.title} title={article.title}/>\n                    <div className=\"title\">{article.title}</div>\n                    <div className=\"date\">{article.name}</div>\n                    <div className=\"date\">\n                        <span className=\"date\">{article.time}</span>\n                        <span> . </span>\n                        <span className=\"readtime\">{article.readtime}</span>\n                    </div>\n                    <button className=\"article-btn\" onClick = {handleShow}>Details</button>\n                </Card.Body>\n            </Card>\n            <ArticleModal show = {show} handleClose = {handleClose} article = {article} handleOpen={handleCheckingTrue}/>\n        </div>\n    \n    )\n}\n\nArticle.propTypes = {\n    article: PropTypes.object.isRequired\n}\n\nexport default Article\n"]},"metadata":{},"sourceType":"module"}